<!DOCTYPE html>
<html>
<head>
  <!--  <link rel="stylesheet" type="text/css" href="common/docs.css">-->
  <title>Calendar</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="initial-scale = 1.0" />


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

  <script src="js/task.js"></script>
  <script src="js/config.js"></script>
  <script src="js/project.js"></script>
  <script src="js/resource.js"></script>
  <script src="js/calendar.js"></script>

  <script src="js/calendarUtils.js"></script>
  <!--
  <script src="plugin/multidraggable/js/jquery.ui.multidraggable-1.8.8.js"></script>
  <script src="plugin/multidraggable/js/ui.multidraggable.js"></script>

  <script src="plugin/multidraggable/js/jquery-ui-1.8.8.custom.min.js"></script>

  <script src="plugin/multidraggable/js/jquery-1.4.4.min.js"></script> -->

  <link href="calendar.css" rel="stylesheet">



</head>
<body>
  <div id="calendar" style='width:100%; height:400px;'></div>
  <div id="key"></div>


  <script type = "text/javascript">

    var cal = new Calendar();

    cal.init();

  </script>

  <script>
  $(document).ready(function(){
    $(".add_cell").click(function(){
      cal._create_resource();

    });
    /*
    var isDragging = false;

    $(".resource_view_data").on({
      mousedown: function(){
        isDragging = true;
      },
      mousemove: function(){
        if (isDragging)
          $("#row_"+$(this).parent().attr("id")).remove();
      },
      mouseup: function(){
        var wasDragging = isDragging;
        isDragging = false;
        if (!wasDragging) {
            $("#throbble").toggle();
        }
      }
    }, '.resource_cell');
*/
    $(".task_view_rows").on('dblclick', '.task_row_cell', function(){
      var resID = Number($(this).parent().attr("id").replace('row_', ''));
      console.log("this", $(this).index(), resID);
      cal.create_task($(this), resID);
    });


    $(".resource_view_data").on('dblclick', '.resource_cell', function(){
      create_cover();
    });


    $(document).on("sortchange",function(ui, e){
      console.log("Dragging");
      var id = e.item.attr('id');
    });

    $(".resource_view_data").on('click', '.remove_cell', function(){
      var resID = $(this).parent().attr("id");
      $("[res="+resID+"]").remove();
      $("#row_" + resID).remove();
      $(this).parent().remove();
    });


    $('.task_view').on('scroll', function () {
      //console.log($(this).scrollTop())
      $('.resource_view').scrollTop($(this).scrollTop());
    });

    $('.task_view_bars').on('mouseover', '.ui-resizable-handle',function () {
      //console.log($(this).scrollTop())
      //alert("mouseover");
      //$(this).draggable("disable");
      $(this).parent().resizable({ grid: [ config.dateHeaderWidth , config.rowHeight ] });

    });
    $('.task_view_bars').on('mouseover', '.task_bar',function () {
      //console.log($(this).scrollTop())
      //alert("mouseover");
      //$(this).draggable("disable");
      $(this).draggable({
        grid: [ config.dateHeaderWidth , config.rowHeight ],
        drag: function( event, ui ) {

        // Keep the left edge of the element
        // at least 100 pixels from the container
        ui.position.left = Math.max( 2, ui.position.left );
        ui.position.top = Math.max( 3, ui.position.top );
      },
        revert: function( event, ui ){

          return false;
          }
        }).resizable({ grid: [ config.dateHeaderWidth , config.rowHeight ] });

    });
    $('.task_view_bars').on('drag', '.task_bar',function () {
      //console.log($(this).scrollTop())
      //alert("mouseover");
      //$(this).draggable("disable");
      //$(this).draggable({ grid: [ config.dateHeaderWidth , config.rowHeight ] }).resizable({ grid: [ config.dateHeaderWidth , config.rowHeight ] });
    });

    $(document).on('dragstop', function(event, ui) {
      $('#key').html("");
      console.log(event.target.getAttribute("res"))

      console.log(cal.project.get_task_by_resource(event.target.getAttribute("res")));

    });

    $(document).keypress(function(e){
      var key = String.fromCharCode(e.which);
      $('#key').html(key);
    });
    /*
    $(document).on('drag', function(e){
      $('#key').html("dragging time");
    });
    $(document).on('drag', function(e){
      //alert(e.item.innerHTML);
    });
*/
    //sortupdate
    //sortchange
    $('#sortable').sortable({
    change: function(ui, event){
        var id = event.item.attr('id');
        console.log("Id Drag: ",id);
    }
    });
    $( "#sortable" ).disableSelection();



    $( ".task_view_rows").sortable();
    $( ".task_view_rows").disableSelection();

    //$( ".task_view_bars").on("draggable")

  });
  </script>

</body>
</html>
